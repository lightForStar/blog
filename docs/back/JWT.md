# JWT

## 概述

官方文档的翻译：

```txt
JSON Web Token（JWT）是一个开放标准（RFC 7519），它定义了一种紧凑且独立的方式，可以在各方之间作为JSON对象安全地传输信息。此信息可以通过数字签名进行验证和信任。JWT可以使用秘密（使用HMAC算法）或使用RSA或ECDSA的公钥/私钥对进行签名。
虽然JWT可以加密以在各方之间提供保密，但只将专注于签名令牌。签名令牌可以验证其中包含的声明的完整性，而加密令牌则隐藏其他方的声明。当使用公钥/私钥对签署令牌时，签名还证明只有持有私钥的一方是签署私钥的一方。
```

链接：https://jwt.io/introduction/

简单的说JWT可以在网络上传输JSON信息，并且通过签名验证信息是否被篡改

## 作用

JSON Web Token（JWT）可以用作身份验证，并且可以实现单点登录，适用于分布式系统的认证

## sesion和JWT的区别

- session保存在服务端，JWT保存在客户端，每次拿到直接解析便可以获取数据
- session在分布式系统中需要额外处理，每一台服务器都有各自的session，在分布式系统中不能直接使用

## JWT的结构

JWT由三部分组成，分别是头信息（Header）、载荷（Payload）、签名（Signature），中间以（.）分隔，如下格式：

```txt
xxx.yyy.zzz
```

### Header

JWT的头部有两部分：

- 声明类型，这里是jwt
- 声明加密的算法，通常直接使用HMACSHA256，就是HS256了

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

### Payload

载荷也有几个部分组成

- 标准中注册的声明（建议但不强制使用）
  - **iss**: jwt签发者
  - **sub**: jwt所面向的用户
  - **aud**: 接收jwt的一方
  - **exp**: jwt的过期时间，这个过期时间必须要大于签发时间
  - **nbf**: 定义在什么时间之前，该jwt都是不可用的.
  - **iat**: jwt的签发时间
  - **jti**: jwt的唯一身份标识，主要用来作为一次性token,从而回避重放攻击。
- 公共的声明
  - 公共的声明可以添加任何的信息。一般这里我们会存放一下用户的基本信息（非敏感信息）。
- 私有的声明
  - 提供方和使用方协商的声明字段

### Signature

为了保证数据的有效性，对前面的Header和Playload进行Base64编码之后混合密钥进行加密

要创建签名部分，必须采用编码的Header，编码的Payload，秘钥，Header中指定的算法，并对其进行签名。
例如，如果要使用HMAC SHA256算法，将按以下方式创建签名：

```java
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret)
```

## 使用

服务端签发JWT发送给客户端，客户端拿到之后进行保存，下次访问服务端时放在请求头中或者cookie中，服务端进行验证，如果验证通过则客户端身份正确

可以用在登录、授权（一次性验证、单点登录等待）等场景

签发-验证都有实现了可以到官网中查看https://jwt.io/#debugger

## 优点

- 无状态，不需要存储在服务端减轻服务端压力
- 单点登录友好

## 缺点

- 无法控制JWT的过期时间，注销、修改密码、退出登录等场景无法使JWT失效
- 不支持续签

常见的解决方案

- 将JWT存入redis中
- 黑名单机制
- 缩短JWT的有效时间

